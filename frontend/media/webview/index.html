<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'none'; style-src {{cspSource}} 'unsafe-inline' https://fonts.googleapis.com https://cdn.jsdelivr.net; script-src 'nonce-{{nonce}}' https://d3js.org https://cdn.jsdelivr.net; img-src {{cspSource}} data: https://avatars.githubusercontent.com https://*.googleusercontent.com; font-src {{cspSource}} https://fonts.gstatic.com https://cdn.jsdelivr.net;">
    <title>LLM Architecture</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
    <script nonce="{{nonce}}" src="https://d3js.org/d3.v7.min.js"></script>
    <script nonce="{{nonce}}" src="https://cdn.jsdelivr.net/npm/dagre@0.8.5/dist/dagre.min.js"></script>
    <link rel="stylesheet" href="{{stylesUri}}">
</head>
<body>
    <div id="header">
        <div class="header-left">
            <svg class="codag-logo" viewBox="0 0 183.49023 48.22958" xmlns="http://www.w3.org/2000/svg">
              <g transform="translate(-4.663109,-100.21196)">
                <circle fill="currentColor" cx="12.989979" cy="136.37827" r="8.32687" />
                <path fill="currentColor" d="m 23.348962,100.21197 c -1.884958,0 -3.402376,1.51742 -3.402376,3.40238 v 22.4131 c 0,1.88496 1.517418,3.40238 3.402376,3.40238 h 22.413103 c 1.884958,0 3.402376,-1.51742 3.402376,-3.40238 v -22.4131 c 0,-1.88496 -1.517418,-3.40238 -3.402376,-3.40238 z m 11.30267,6.39083 a 8.32687,8.32687 0 0 1 8.32714,8.32714 8.32687,8.32687 0 0 1 -8.32714,8.32662 8.32687,8.32687 0 0 1 -8.326624,-8.32662 8.32687,8.32687 0 0 1 8.326624,-8.32714 z" />
                <path fill="currentColor" d="m 12.407616,130.60648 13.191254,-13.19125 6.269113,6.39971 -15.411566,15.41157 z" />
                <text fill="currentColor" style="font-size:44.0158px;font-weight:bold;font-family:Damascus,system-ui,-apple-system,sans-serif" x="55.822399" y="131.09103" transform="scale(0.94435948,1.0589188)">codag</text>
              </g>
            </svg>
            <div id="auth-section" class="auth-section">
                <!-- Trial mode (hidden when logged in) -->
                <span id="trial-tag" class="trial-tag">
                    FREE TRIAL <span id="trial-remaining">5/5</span>
                </span>
                <button id="btn-signup" class="signup-btn">Sign Up / Login</button>

                <!-- Logged in mode (hidden when trial) -->
                <button id="btn-user-profile" class="user-profile-btn hidden">
                    <img id="user-avatar" class="user-avatar" src="" alt="">
                    <span id="user-greeting">Hi User</span>
                    <svg class="dropdown-arrow" viewBox="0 0 12 12"><path d="M2 4l4 4 4-4"/></svg>
                </button>

                <!-- User dropdown -->
                <div id="userDropdown" class="user-dropdown">
                    <div class="dropdown-header">
                        <img id="dropdown-avatar" class="dropdown-avatar" src="" alt="">
                        <div class="dropdown-info">
                            <span id="dropdown-name" class="dropdown-name">User Name</span>
                            <span id="dropdown-email" class="dropdown-email">user@email.com</span>
                        </div>
                    </div>
                    <div class="dropdown-divider"></div>
                    <div class="dropdown-provider">
                        <span id="dropdown-provider-icon"></span>
                        <span id="dropdown-provider-text">Signed in with GitHub</span>
                    </div>
                    <div class="dropdown-divider"></div>
                    <button id="btn-logout" class="dropdown-logout">Log out</button>
                </div>
            </div>
            <div id="snapshot" class="snapshot-stats">
                <span class="stat-label"><span id="statWorkflows">0</span> workflows</span>
                <span class="stat-divider">·</span>
                <span class="stat-label"><span id="statLlmCalls">0</span> LLM nodes</span>
                <span class="stat-divider">·</span>
                <span class="stat-label">Last updated at <span id="statTimestamp">--:--</span></span>
            </div>
        </div>
        <div id="controls">
            <button id="btn-zoom-in" title="Zoom In">
                <svg viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
            </button>
            <button id="btn-zoom-out" title="Zoom Out">
                <svg viewBox="0 0 24 24"><path d="M19 13H5v-2h14v2z"/></svg>
            </button>
            <button id="btn-fit-screen" title="Fit to Screen">
                <svg viewBox="0 0 24 24"><path d="M3 3h6v2H5v4H3V3zm18 0v6h-2V5h-4V3h6zM3 15v6h6v-2H5v-4H3zm16 0v4h-4v2h6v-6h-2z"/></svg>
            </button>
            <button id="btn-expand-all" class="expand-btn" title="Expand/Collapse All Workflows">
                <svg viewBox="0 0 24 24"><path d="M12 5.83L15.17 9l1.41-1.41L12 3 7.41 7.59 8.83 9 12 5.83zm0 12.34L8.83 15l-1.41 1.41L12 21l4.59-4.59L15.17 15 12 18.17z"/></svg>
            </button>
            <button id="btn-format" class="format-btn" title="Reset Layout">
                <svg viewBox="0 0 24 24"><path d="M3 3v8h8V3H3zm6 6H5V5h4v4zm-6 4v8h8v-8H3zm6 6H5v-4h4v4zm4-16v8h8V3h-8zm6 6h-4V5h4v4zm-6 4v8h8v-8h-8zm6 6h-4v-4h4v4z"/></svg>
            </button>
            <button id="btn-analyze" class="analyze-btn" title="Analyze Files">
                <svg viewBox="0 0 24 24"><path d="M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"/></svg>
            </button>
        </div>
    </div>

    <div id="graph"></div>

    <div id="workflowDirectory" class="workflow-directory">
        <div class="directory-header">
            <span class="directory-title">Workflow Directory</span>
            <button id="btn-toggle-directory" class="directory-toggle">▼</button>
        </div>
        <div class="directory-scroll-container">
            <div class="scroll-indicator scroll-indicator-top">▲</div>
            <div id="directoryList" class="directory-list"></div>
            <div class="scroll-indicator scroll-indicator-bottom">▼</div>
        </div>
    </div>

    <div id="buttonTooltip" class="button-tooltip"></div>

    <div id="minimap"></div>

    <div id="edgeTooltip" class="edge-tooltip" style="display: none;"></div>

    <div id="loadingIndicator" class="loading-indicator" style="display: none;">
        <div class="loading-content">
            <div>
                <div class="loading-icon">⏳</div>
                <div class="loading-text">Analyzing workflow...</div>
            </div>
            <div class="progress-bar-container" style="display: none;">
                <div class="progress-bar-fill" style="width: 0%;"></div>
            </div>
        </div>
    </div>

    <div id="progressOverlay" class="progress-overlay" style="display: none;">
        <div class="overlay-content">
            <div class="overlay-spinner">⟳</div>
            <div class="overlay-text">Processing...</div>
        </div>
    </div>

    <div id="sidePanel" class="side-panel">
        <div class="panel-header">
            <div class="panel-header-left">
                <h2 id="panelTitle">Node Details</h2>
                <p id="panelWorkflow" class="panel-workflow"></p>
            </div>
            <button class="close-btn" id="btn-close-panel">&times;</button>
        </div>
        <div class="panel-content">
            <div class="panel-section">
                <label>Type</label>
                <div id="panelType" class="type-badge">-</div>
            </div>
            <div id="descriptionSection" class="panel-section">
                <label>Description</label>
                <p id="panelDescription">-</p>
            </div>
            <div id="sourceSection" class="panel-section">
                <label>Source Location</label>
                <a id="panelSource" class="source-link" href="#">-</a>
            </div>
            <div id="incomingSection" class="panel-section">
                <label>Incoming Data</label>
                <div id="panelIncoming">-</div>
            </div>
            <div id="outgoingSection" class="panel-section">
                <label>Outgoing Data</label>
                <div id="panelOutgoing">-</div>
            </div>
        </div>
    </div>

    <div id="authPanel" class="auth-panel">
        <div class="auth-panel-header">
            <h2>Create Account</h2>
            <button class="close-btn" id="btn-close-auth">&times;</button>
        </div>
        <div class="auth-panel-content">
            <p class="auth-description">Sign up for unlimited analyses</p>
            <button id="btn-oauth-github" class="oauth-btn github">
                <svg viewBox="0 0 24 24" width="20" height="20">
                    <path fill="currentColor" d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                </svg>
                Continue with GitHub
            </button>
            <button id="btn-oauth-google" class="oauth-btn google">
                <svg viewBox="0 0 24 24" width="20" height="20">
                    <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                    <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                    <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                    <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                </svg>
                Continue with Google
            </button>
        </div>
    </div>

</body>
</html>
